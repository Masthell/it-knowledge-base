### VPN: Site-to-Site и Remote Access

туториал 
https://youtu.be/3vHf3kHn9jo?si=hDw_jNtxskK72YBl

Терминология

Site-to-Site VPN (IPsec)

Что это: Постоянный безопасный туннель между двумя сетями (офисами)

Как работает:

Два маршрутизатора аутентифицируются друг с другом

Создаётся зашифрованный канал

Весь трафик между сетями проходит через туннель
Пример: Главный офис в Москве (192.168.1.0/24) ↔ Филиал в Питере (192.168.2.0/24)

#### Remote Access VPN (OpenVPN/WireGuard)
Что это: Персональный безопасный доступ для удалённых пользователей

Как работает:

Пользователь запускает VPN-клиент

Подключается к VPN-серверу компании

Получает доступ к внутренним ресурсам как из локальной сети

Пример: Работа из дома с доступом к файловому серверу компании

#### OPNsense - швейцарский нож сетевой безопасности или IPsec

Что такое OPNsense?

OPNsense — это открытая система защиты периметра на базе FreeBSD с веб-интерфейсом.

Основные функции:
Фаервол — контроль входящего/исходящего трафика

VPN-шлюз — поддержка IPsec, OpenVPN, WireGuard

DHCP/DNS-сервер — автоматическая раздача IP и разрешение имён

Мониторинг — графики трафика, логи соединений

IDS/IPS — система обнаружения и предотвращения вторжений

Почему OPNsense для домашней лаборатории?

Бесплатен — полный функционал без ограничений

Профессионален — используется в бизнес-среде

Документирован — обширная документация и форум

Модулен — можно добавлять функциональность через плагины

Практическая настройка: OPNsense + IPsec + OpenVPN
Архитектура лаборатории:
```
[Домашний ПК (Windows)]
        |
    [VMware Workstation]
        |
    ┌─────────────────────────────────────┐
    │         Виртуальная сеть            │
    │  (VMnet2: 10.0.0.0/24 - "интернет") │
    └─────────────────────────────────────┘
        |                    |
[OPNsense-MSK]          [OPNsense-SPB]
(10.0.0.1)              (10.0.0.2)
    |                        |
[LAN: 192.168.1.0/24]  [LAN: 192.168.2.0/24]
    |                        |
[Ubuntu-MSK]           [Ubuntu-SPB]
(192.168.1.100)        (192.168.2.100)
```
Этапы настройки:

вот здесь нужно было добвлять сети а еще внутри виртуалки можно оказывается добавлять коннекты с сетями 

<img width="1280" height="745" alt="image" src="https://github.com/user-attachments/assets/e9eee5b6-1ad1-4ef6-9bce-afb9f13e0994" />

командой инсталлер опнсенсе был виден загрузчик

<img width="1280" height="719" alt="image" src="https://github.com/user-attachments/assets/c74c7dec-5b66-4ae2-87ef-696cf590633d" />

вот здесь я уже все установила но лучше следоватьСТРООГО инструкциям дажже если n или N решает роль при выборе регистр и так же айпи адресс виден какой где

<img width="1280" height="668" alt="image" src="https://github.com/user-attachments/assets/1a0a5119-d71f-4764-a767-701feb2891d5" />

все работает
<img width="1280" height="719" alt="image" src="https://github.com/user-attachments/assets/8aad3bbc-57d4-4a04-9892-16b22e445429" />


Установка OPNsense

Скачать образ с opnsense.org/download

Создать ВМ с 2+ ГБ RAM, 2+ ядрами, 2 сетевыми адаптерами

Назначить интерфейсы: WAN (внешний), LAN (внутренний)

Настройка сетей в VMware


####  Команды для проверки:

Проверка IPsec туннеля
ping 192.168.2.100  # с Ubuntu-MSK на Ubuntu-SPB

#### Проверка OpenVPN
ipconfig /all        # на Windows после подключения
ping 192.168.1.1     # доступ к шлюзу через VPN
